{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Wyczyść Flash",
            "type": "shell",
            "command": "C:\\Program Files (x86)\\OpenOCD-20240916-0.12.0\\bin\\OPENOCD.EXE",
            "args": [
                "-f", "interface/stlink.cfg",
                "-f", "target/${config:STM32_FAMILY_OCD}.cfg",
                "-c", "init",
                "-c", "halt",
                "-c", "flash erase_sector 0 0 last",
                "-c", "shutdown"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "group": {
                "kind": "build"
            }
        },
        {
            "label": "Wyczyść Debug",
            "type": "shell",
            "command": "make",
            "args": [
                "BUILD_TYPE=Debug",
                "Wyczysc_Debug"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "group": {
                "kind": "build"
            }
        },
        {
            "label": "Wyczyść Release",
            "type": "shell",
            "command": "make",
            "args": [
                "BUILD_TYPE=Release",
                "Wyczysc_Release"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "group": {
                "kind": "build"
            }
        },
        {
            "label": "Buduj Debug",
            "type": "shell",
            "command": "make",
            "args": [
                "BUILD_TYPE=Debug",
                "-j8"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn": "Wyczyść Debug",
            "group": {
                "kind": "build"
            },
            "problemMatcher": [
                "$gcc"
            ]
        },
        {
            "label": "Buduj Release",
            "type": "shell",
            "command": "make",
            "args": [
                "BUILD_TYPE=Release",
                "-j8"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn": "Wyczyść Release",
            "group": {
                "kind": "build"
            },
            "problemMatcher": [
                "$gcc"
            ]
        },
        {
            "label": "Wgraj Debug",
            "type": "shell",
            "command": "C:\\Program Files (x86)\\OpenOCD-20240916-0.12.0\\bin\\OPENOCD.EXE",
            "args": [
                "-f", "interface/stlink.cfg",
                "-f", "target/${config:STM32_FAMILY_OCD}.cfg",
                "-c", "program Build/Debug/${config:STM32_TARGET}.elf verify reset exit"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn": "Buduj Debug",
            "group": {
                "kind": "build"
            }
        },
        {
            "label": "Wgraj Release",
            "type": "shell",
            "command": "C:\\Program Files (x86)\\OpenOCD-20240916-0.12.0\\bin\\OPENOCD.EXE",
            "args": [
                "-f", "interface/stlink.cfg",
                "-f", "target/${config:STM32_FAMILY_OCD}.cfg",
                "-c", "program Build/Release/${config:STM32_TARGET}.elf verify reset exit"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn": "Buduj Release",
            "group": {
                "kind": "build"
            }
        },

        // ===== NOWY TASK =====
        {
            "label": "Addr2line",
            "type": "shell",
            "command": "arm-none-eabi-addr2line.exe",
            "args": [
                "-s",                                  // <-- NOWE: tylko nazwa pliku, bez ścieżki
                "-e",
                "Build/Debug/${config:STM32_TARGET}.elf",
                "${input:CrashAddress}"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "group": "none"
        }
    ],

    "inputs": [
        {
            "id": "CrashAddress",
            "type": "promptString",
            "description": "Podaj adres (np. 0x40147d)",
            "default": "0x080024a2"
        }
    ]
}